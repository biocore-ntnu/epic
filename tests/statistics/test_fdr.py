import pytest

from io import StringIO
import pandas as pd
from numpy import allclose, array_equal, int32

from epic.windows.count.count_reads_in_windows import count_reads_in_windows, _count_reads_in_windows_paired_end


@pytest.mark.integration
def test_fdr(expected_result, args_200):
    # total_chip_reads 9904
    # total_input_reads 9290
    pass


@pytest.fixture
def expected_result():

    contents = """Chromosome Start End ChIP Input Score P_value FDR_value
chr1 23568400 23568599 2 0.0 13.498144796491546
chr1 26401200 26401399 2 0.0 13.498144796491546
chr1 33054800 33055399 2 0.0 14.105738643033899
chr1 33365200 33365399 2 0.0 13.498144796491546
chr1 39422200 39422799 2 0.0 14.105738643033899
chr1 51473600 51474399 2 0.0 14.105738643033899
chr1 58785200 58786199 2 0.0 14.105738643033899
chr1 59430000 59430199 2 0.0 13.498144796491546
chr1 65065600 65066199 2 0.0 14.105738643033899
chr1 91625400 91625799 2 0.0 14.105738643033899
chr1 100589600 100589799 2 0.0 13.498144796491546
chr1 103840400 103841199 2 0.0 14.105738643033899
chr1 113416400 113416799 2 0.0 14.105738643033899
chr1 113486600 113487199 2 0.0 14.105738643033899
chr1 115014800 115014999 2 0.0 13.498144796491546
chr1 144181400 144181999 2 0.0 14.105738643033899
chr1 171053400 171054599 3 0.0 21.158607964550846
chr1 181707400 181707999 2 0.0 14.105738643033899
chr1 203357400 203357799 2 0.0 14.105738643033899
chr1 210178400 210178999 2 0.0 14.105738643033899
chr1 210471400 210471599 2 0.0 13.498144796491546
chr1 219659800 219660199 2 0.0 14.105738643033899
chr1 220704400 220705199 2 0.0 14.105738643033899
chr2 32400 33399 2 0.0 14.105738643033899
chr2 15618800 15619599 2 0.0 14.105738643033899
chr2 39208000 39208799 2 0.0 14.105738643033899
chr2 48521000 48521199 2 0.0 13.498144796491546
chr2 61986000 61986599 2 0.0 14.105738643033899
chr2 73314400 73315199 2 0.0 14.105738643033899
chr2 101681600 101682399 2 0.0 14.105738643033899
chr2 136216000 136216799 2 0.0 14.105738643033899
chr2 175474200 175474599 2 0.0 14.105738643033899
chr2 181811200 181811799 2 0.0 14.105738643033899
chr2 201039600 201040199 2 0.0 14.105738643033899
chr2 202215400 202215799 2 0.0 14.105738643033899
chr2 207865600 207866599 2 0.0 14.105738643033899
chr2 224033800 224034799 2 0.0 14.105738643033899
chr3 85593400 85594199 2 0.0 14.105738643033899
chr3 88280800 88281399 2 0.0 14.105738643033899
chr3 116714000 116714599 2 0.0 14.105738643033899
chr3 130362000 130362799 2 0.0 14.105738643033899
chr3 139795400 139796199 2 0.0 14.105738643033899
chr3 161112200 161112999 2 0.0 14.105738643033899
chr3 187144000 187144199 2 0.0 13.498144796491546
chr3 195381600 195382599 2 0.0 14.105738643033899
chr3 197835600 197835999 2 0.0 14.105738643033899
chr4 4342200 4342799 2 0.0 14.105738643033899
chr4 20235600 20236399 2 0.0 14.105738643033899
chr4 37984000 37984799 2 0.0 14.105738643033899
chr4 47534200 47534599 2 0.0 14.105738643033899
chr4 78769800 78770599 2 0.0 14.105738643033899
chr4 82095400 82095599 2 0.0 13.498144796491546
chr4 122316200 122316999 2 0.0 14.105738643033899
chr4 148758400 148758599 2 0.0 13.498144796491546
chr4 150551800 150552599 2 0.0 14.105738643033899
chr4 177477400 177477799 2 0.0 14.105738643033899
chr5 25080600 25081599 2 0.0 14.105738643033899
chr5 122802800 122803799 2 0.0 14.105738643033899
chr5 129214000 129214599 2 0.0 14.105738643033899
chr5 131383800 131383999 2 0.0 13.498144796491546
chr5 149809600 149809799 2 0.0 13.498144796491546
chr5 153445000 153445799 2 0.0 14.105738643033899
chr5 158534800 158534999 2 0.0 13.498144796491546
chr6 8145600 8146199 2 0.0 14.105738643033899
chr6 13436000 13436599 2 0.0 14.105738643033899
chr6 14965600 14965799 2 0.0 13.498144796491546
chr6 28180800 28181199 2 0.0 14.105738643033899
chr6 40716200 40716799 2 0.0 14.105738643033899
chr6 58887000 58887199 2 0.0 13.498144796491546
chr6 83528200 83528999 2 0.0 14.105738643033899
chr6 84993400 84994399 2 0.0 14.105738643033899
chr6 87841600 87842599 2 0.0 14.105738643033899
chr6 88523200 88523599 2 0.0 14.105738643033899
chr6 109943000 109943799 2 0.0 14.105738643033899
chr6 127877800 127878199 2 0.0 14.105738643033899
chr6 135900600 135900999 2 0.0 14.105738643033899
chr7 2360400 2360799 2 0.0 14.105738643033899
chr7 3069200 3069599 2 0.0 14.105738643033899
chr7 18196600 18197599 2 0.0 14.105738643033899
chr7 21904400 21905199 2 0.0 14.105738643033899
chr7 25267200 25267999 2 0.0 14.105738643033899
chr7 44197400 44198199 2 0.0 14.105738643033899
chr7 44263800 44264399 2 0.0 14.105738643033899
chr7 61606400 61606799 3 2.0 20.551014118008496
chr7 88799600 88799999 2 0.0 14.105738643033899
chr7 89812600 89812799 2 0.0 13.498144796491546
chr7 91995000 91995399 2 0.0 14.105738643033899
chr7 93845800 93845999 2 0.0 13.498144796491546
chr7 134483600 134483999 2 0.0 14.105738643033899
chr7 148268000 148268999 2 0.0 14.105738643033899
chr8 38686400 38687399 2 0.0 14.105738643033899
chr8 53868200 53868999 2 0.0 14.105738643033899
chr8 70537400 70537999 2 0.0 14.105738643033899
chr8 82435600 82436399 2 0.0 14.105738643033899
chr8 95555000 95555999 2 0.0 14.105738643033899
chr8 100094400 100094599 2 0.0 13.498144796491546
chr8 101227400 101227599 2 0.0 13.498144796491546
chr8 125556600 125556799 2 0.0 13.498144796491546
chr9 26937600 26937799 2 0.0 13.498144796491546
chr9 38268800 38268999 2 0.0 13.498144796491546
chr9 97678000 97678399 2 0.0 14.105738643033899
chr9 100604000 100604399 2 0.0 14.105738643033899
chr9 129517800 129517999 2 0.0 13.498144796491546
chr10 10498200 10498599 2 0.0 14.105738643033899
chr10 48098200 48098799 2 0.0 14.105738643033899
chr10 63417600 63417999 2 0.0 14.105738643033899
chr10 98847000 98847399 2 0.0 14.105738643033899
chr10 131154400 131154799 2 0.0 14.105738643033899
chr11 16716400 16716999 2 0.0 14.105738643033899
chr11 22604000 22604399 2 0.0 14.105738643033899
chr11 31487600 31488599 2 0.0 14.105738643033899
chr11 34336800 34337399 2 0.0 14.105738643033899
chr11 44015000 44015399 2 0.0 14.105738643033899
chr11 117422000 117422399 2 0.0 14.105738643033899
chr12 9384600 9385599 2 0.0 14.105738643033899
chr12 12115600 12116599 2 0.0 14.105738643033899
chr12 24857800 24858399 2 0.0 14.105738643033899
chr12 44406000 44406999 4 0.0 27.603883439525447
chr12 55551600 55551999 2 0.0 14.105738643033899
chr12 56139000 56139599 2 0.0 14.105738643033899
chr12 64597600 64597999 2 0.0 14.105738643033899
chr12 88270200 88270799 2 0.0 14.105738643033899
chr12 95094400 95095399 2 0.0 14.105738643033899
chr12 96881600 96881799 2 0.0 13.498144796491546
chr12 106602400 106603599 4 0.0 27.603883439525447
chr13 33041400 33042399 3 0.0 21.158607964550846
chr13 36535600 36535999 2 0.0 14.105738643033899
chr13 48438200 48438599 2 0.0 14.105738643033899
chr13 113095600 113095999 2 0.0 14.105738643033899
chr14 30160600 30161599 2 0.0 14.105738643033899
chr14 44201400 44201799 2 0.0 14.105738643033899
chr14 54727600 54727799 2 0.0 13.498144796491546
chr14 67356600 67356999 2 0.0 14.105738643033899
chr14 75051400 75051799 2 0.0 14.105738643033899
chr14 76404200 76404399 2 0.0 13.498144796491546
chr14 76912200 76912799 2 0.0 14.105738643033899
chr15 38781800 38782599 2 0.0 14.105738643033899
chr15 57638400 57638999 2 0.0 14.105738643033899
chr15 76517200 76517399 2 0.0 13.498144796491546
chr16 9080000 9080599 2 0.0 14.105738643033899
chr16 20683000 20683799 2 0.0 14.105738643033899
chr16 20724800 20725799 2 0.0 14.105738643033899
chr16 22216800 22217199 2 0.0 14.105738643033899
chr16 28892800 28893599 2 0.0 14.105738643033899
chr16 30612600 30612999 2 0.0 14.105738643033899
chr16 52910600 52911399 2 0.0 14.105738643033899
chr16 65955600 65956399 2 0.0 14.105738643033899
chr16 67987600 67988199 2 0.0 14.105738643033899
chr16 83646600 83647399 2 0.0 14.105738643033899
chr16 83749000 83749599 3 0.0 20.551014118008496
chr17 6340000 6340199 2 0.0 13.498144796491546
chr17 8036400 8036799 2 0.0 14.105738643033899
chr17 16496800 16497799 2 0.0 14.105738643033899
chr17 30567400 30568399 2 0.0 14.105738643033899
chr17 34235000 34235399 2 0.0 14.105738643033899
chr17 35277000 35277399 2 0.0 14.105738643033899
chr17 71748600 71748799 2 0.0 13.498144796491546
chr18 9324200 9324399 2 0.0 13.498144796491546
chr18 14914400 14915399 2 0.0 14.105738643033899
chr19 17239200 17239799 2 0.0 14.105738643033899
chr19 45288400 45288999 2 0.0 14.105738643033899
chr20 43477600 43477799 2 0.0 13.498144796491546
chr22 16398800 16399599 2 0.0 14.105738643033899
chr22 35502000 35502999 2 0.0 14.105738643033899
chrX 37591800 37592199 2 0.0 14.105738643033899
chrX 76940200 76940599 2 0.0 14.105738643033899"""

    df = pd.read_table(
        StringIO(u"""Count Chromosome Bin
    2 chr1 39036800
    1 chr1 73781000
    1 chr1 90059800
    1 chr3 55648200
    1 chr7 20246600
    1 chr7 91135000
    1 chr13 100938400
    1 chr19 43528800
    1 chr19 47108800"""),
        sep=r"\s+",
        dtype={"Count": int32,
               "Bin": int32})
    return df


@pytest.fixture
def input_bed_file(tmpdir):
    bed_file = tmpdir.join("fdr.csv")
    bed_file.write("""Chromosome Start End ChIP Input Score
chr1 23568400 23568599 2 0.0 13.498144796491546
chr1 26401200 26401399 2 0.0 13.498144796491546
chr1 33054800 33055399 2 0.0 14.105738643033899
chr1 33365200 33365399 2 0.0 13.498144796491546
chr1 39422200 39422799 2 0.0 14.105738643033899
chr1 51473600 51474399 2 0.0 14.105738643033899
chr1 58785200 58786199 2 0.0 14.105738643033899
chr1 59430000 59430199 2 0.0 13.498144796491546
chr1 65065600 65066199 2 0.0 14.105738643033899
chr1 91625400 91625799 2 0.0 14.105738643033899
chr1 100589600 100589799 2 0.0 13.498144796491546
chr1 103840400 103841199 2 0.0 14.105738643033899
chr1 113416400 113416799 2 0.0 14.105738643033899
chr1 113486600 113487199 2 0.0 14.105738643033899
chr1 115014800 115014999 2 0.0 13.498144796491546
chr1 144181400 144181999 2 0.0 14.105738643033899
chr1 171053400 171054599 3 0.0 21.158607964550846
chr1 181707400 181707999 2 0.0 14.105738643033899
chr1 203357400 203357799 2 0.0 14.105738643033899
chr1 210178400 210178999 2 0.0 14.105738643033899
chr1 210471400 210471599 2 0.0 13.498144796491546
chr1 219659800 219660199 2 0.0 14.105738643033899
chr1 220704400 220705199 2 0.0 14.105738643033899
chr2 32400 33399 2 0.0 14.105738643033899
chr2 15618800 15619599 2 0.0 14.105738643033899
chr2 39208000 39208799 2 0.0 14.105738643033899
chr2 48521000 48521199 2 0.0 13.498144796491546
chr2 61986000 61986599 2 0.0 14.105738643033899
chr2 73314400 73315199 2 0.0 14.105738643033899
chr2 101681600 101682399 2 0.0 14.105738643033899
chr2 136216000 136216799 2 0.0 14.105738643033899
chr2 175474200 175474599 2 0.0 14.105738643033899
chr2 181811200 181811799 2 0.0 14.105738643033899
chr2 201039600 201040199 2 0.0 14.105738643033899
chr2 202215400 202215799 2 0.0 14.105738643033899
chr2 207865600 207866599 2 0.0 14.105738643033899
chr2 224033800 224034799 2 0.0 14.105738643033899
chr3 85593400 85594199 2 0.0 14.105738643033899
chr3 88280800 88281399 2 0.0 14.105738643033899
chr3 116714000 116714599 2 0.0 14.105738643033899
chr3 130362000 130362799 2 0.0 14.105738643033899
chr3 139795400 139796199 2 0.0 14.105738643033899
chr3 161112200 161112999 2 0.0 14.105738643033899
chr3 187144000 187144199 2 0.0 13.498144796491546
chr3 195381600 195382599 2 0.0 14.105738643033899
chr3 197835600 197835999 2 0.0 14.105738643033899
chr4 4342200 4342799 2 0.0 14.105738643033899
chr4 20235600 20236399 2 0.0 14.105738643033899
chr4 37984000 37984799 2 0.0 14.105738643033899
chr4 47534200 47534599 2 0.0 14.105738643033899
chr4 78769800 78770599 2 0.0 14.105738643033899
chr4 82095400 82095599 2 0.0 13.498144796491546
chr4 122316200 122316999 2 0.0 14.105738643033899
chr4 148758400 148758599 2 0.0 13.498144796491546
chr4 150551800 150552599 2 0.0 14.105738643033899
chr4 177477400 177477799 2 0.0 14.105738643033899
chr5 25080600 25081599 2 0.0 14.105738643033899
chr5 122802800 122803799 2 0.0 14.105738643033899
chr5 129214000 129214599 2 0.0 14.105738643033899
chr5 131383800 131383999 2 0.0 13.498144796491546
chr5 149809600 149809799 2 0.0 13.498144796491546
chr5 153445000 153445799 2 0.0 14.105738643033899
chr5 158534800 158534999 2 0.0 13.498144796491546
chr6 8145600 8146199 2 0.0 14.105738643033899
chr6 13436000 13436599 2 0.0 14.105738643033899
chr6 14965600 14965799 2 0.0 13.498144796491546
chr6 28180800 28181199 2 0.0 14.105738643033899
chr6 40716200 40716799 2 0.0 14.105738643033899
chr6 58887000 58887199 2 0.0 13.498144796491546
chr6 83528200 83528999 2 0.0 14.105738643033899
chr6 84993400 84994399 2 0.0 14.105738643033899
chr6 87841600 87842599 2 0.0 14.105738643033899
chr6 88523200 88523599 2 0.0 14.105738643033899
chr6 109943000 109943799 2 0.0 14.105738643033899
chr6 127877800 127878199 2 0.0 14.105738643033899
chr6 135900600 135900999 2 0.0 14.105738643033899
chr7 2360400 2360799 2 0.0 14.105738643033899
chr7 3069200 3069599 2 0.0 14.105738643033899
chr7 18196600 18197599 2 0.0 14.105738643033899
chr7 21904400 21905199 2 0.0 14.105738643033899
chr7 25267200 25267999 2 0.0 14.105738643033899
chr7 44197400 44198199 2 0.0 14.105738643033899
chr7 44263800 44264399 2 0.0 14.105738643033899
chr7 61606400 61606799 3 2.0 20.551014118008496
chr7 88799600 88799999 2 0.0 14.105738643033899
chr7 89812600 89812799 2 0.0 13.498144796491546
chr7 91995000 91995399 2 0.0 14.105738643033899
chr7 93845800 93845999 2 0.0 13.498144796491546
chr7 134483600 134483999 2 0.0 14.105738643033899
chr7 148268000 148268999 2 0.0 14.105738643033899
chr8 38686400 38687399 2 0.0 14.105738643033899
chr8 53868200 53868999 2 0.0 14.105738643033899
chr8 70537400 70537999 2 0.0 14.105738643033899
chr8 82435600 82436399 2 0.0 14.105738643033899
chr8 95555000 95555999 2 0.0 14.105738643033899
chr8 100094400 100094599 2 0.0 13.498144796491546
chr8 101227400 101227599 2 0.0 13.498144796491546
chr8 125556600 125556799 2 0.0 13.498144796491546
chr9 26937600 26937799 2 0.0 13.498144796491546
chr9 38268800 38268999 2 0.0 13.498144796491546
chr9 97678000 97678399 2 0.0 14.105738643033899
chr9 100604000 100604399 2 0.0 14.105738643033899
chr9 129517800 129517999 2 0.0 13.498144796491546
chr10 10498200 10498599 2 0.0 14.105738643033899
chr10 48098200 48098799 2 0.0 14.105738643033899
chr10 63417600 63417999 2 0.0 14.105738643033899
chr10 98847000 98847399 2 0.0 14.105738643033899
chr10 131154400 131154799 2 0.0 14.105738643033899
chr11 16716400 16716999 2 0.0 14.105738643033899
chr11 22604000 22604399 2 0.0 14.105738643033899
chr11 31487600 31488599 2 0.0 14.105738643033899
chr11 34336800 34337399 2 0.0 14.105738643033899
chr11 44015000 44015399 2 0.0 14.105738643033899
chr11 117422000 117422399 2 0.0 14.105738643033899
chr12 9384600 9385599 2 0.0 14.105738643033899
chr12 12115600 12116599 2 0.0 14.105738643033899
chr12 24857800 24858399 2 0.0 14.105738643033899
chr12 44406000 44406999 4 0.0 27.603883439525447
chr12 55551600 55551999 2 0.0 14.105738643033899
chr12 56139000 56139599 2 0.0 14.105738643033899
chr12 64597600 64597999 2 0.0 14.105738643033899
chr12 88270200 88270799 2 0.0 14.105738643033899
chr12 95094400 95095399 2 0.0 14.105738643033899
chr12 96881600 96881799 2 0.0 13.498144796491546
chr12 106602400 106603599 4 0.0 27.603883439525447
chr13 33041400 33042399 3 0.0 21.158607964550846
chr13 36535600 36535999 2 0.0 14.105738643033899
chr13 48438200 48438599 2 0.0 14.105738643033899
chr13 113095600 113095999 2 0.0 14.105738643033899
chr14 30160600 30161599 2 0.0 14.105738643033899
chr14 44201400 44201799 2 0.0 14.105738643033899
chr14 54727600 54727799 2 0.0 13.498144796491546
chr14 67356600 67356999 2 0.0 14.105738643033899
chr14 75051400 75051799 2 0.0 14.105738643033899
chr14 76404200 76404399 2 0.0 13.498144796491546
chr14 76912200 76912799 2 0.0 14.105738643033899
chr15 38781800 38782599 2 0.0 14.105738643033899
chr15 57638400 57638999 2 0.0 14.105738643033899
chr15 76517200 76517399 2 0.0 13.498144796491546
chr16 9080000 9080599 2 0.0 14.105738643033899
chr16 20683000 20683799 2 0.0 14.105738643033899
chr16 20724800 20725799 2 0.0 14.105738643033899
chr16 22216800 22217199 2 0.0 14.105738643033899
chr16 28892800 28893599 2 0.0 14.105738643033899
chr16 30612600 30612999 2 0.0 14.105738643033899
chr16 52910600 52911399 2 0.0 14.105738643033899
chr16 65955600 65956399 2 0.0 14.105738643033899
chr16 67987600 67988199 2 0.0 14.105738643033899
chr16 83646600 83647399 2 0.0 14.105738643033899
chr16 83749000 83749599 3 0.0 20.551014118008496
chr17 6340000 6340199 2 0.0 13.498144796491546
chr17 8036400 8036799 2 0.0 14.105738643033899
chr17 16496800 16497799 2 0.0 14.105738643033899
chr17 30567400 30568399 2 0.0 14.105738643033899
chr17 34235000 34235399 2 0.0 14.105738643033899
chr17 35277000 35277399 2 0.0 14.105738643033899
chr17 71748600 71748799 2 0.0 13.498144796491546
chr18 9324200 9324399 2 0.0 13.498144796491546
chr18 14914400 14915399 2 0.0 14.105738643033899
chr19 17239200 17239799 2 0.0 14.105738643033899
chr19 45288400 45288999 2 0.0 14.105738643033899
chr20 43477600 43477799 2 0.0 13.498144796491546
chr22 16398800 16399599 2 0.0 14.105738643033899
chr22 35502000 35502999 2 0.0 14.105738643033899
chrX 37591800 37592199 2 0.0 14.105738643033899
chrX 76940200 76940599 2 0.0 14.105738643033899""")

    return str(bed_file)
